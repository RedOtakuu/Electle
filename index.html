<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electle - Parliament Game</title>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    
    <style>
        :root {
            --bg-color: #1a1a1b;
            --ocean-color: #2c2c2e;
            --text-color: #ffffff;
            --accent-blue: #4a90e2;
            --correct-green: #538d4e;
            --partial-yellow: #b59f3b;
            --wrong-red: #3a3a3c;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        header { padding: 10px; font-weight: bold; font-size: 1.2rem; letter-spacing: 2px; border-bottom: 1px solid #333; width: 100%; text-align: center; background: var(--bg-color); z-index: 10; }

        .top-section { margin-top: 10px; width: 100%; max-width: 800px; display: flex; justify-content: center; flex-shrink: 0; }
        
        .diagram-container {
            background: white; padding: 5px; border-radius: var(--border-radius); height: 160px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
            width: 300px; /* –§–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É, —á—Ç–æ–±—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–æ */
        }
        
        /* –í–ê–ñ–ù–û: object-fit contain —á—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∞—Å—å */
        .diagram-container img { max-height: 100%; max-width: 100%; object-fit: contain; display: block; }

        .map-wrapper {
            width: 95%; max-width: 900px; 
            flex-grow: 1; 
            background-color: var(--ocean-color); border: 1px solid #444;
            border-radius: var(--border-radius); position: relative; overflow: hidden; margin: 10px 0;
        }
        svg { width: 100%; height: 100%; cursor: grab; }
        svg:active { cursor: grabbing; }

        path { fill: #d3d3d3; stroke: #111; stroke-width: 0.5px; transition: fill 0.3s; cursor: pointer; }
        path:hover { fill: #bbb; }
        path.selected { fill: var(--accent-blue) !important; }
        path.correct { fill: var(--correct-green) !important; }
        path.wrong { fill: var(--wrong-red) !important; opacity: 0.4; }
        path.regional { fill: var(--partial-yellow) !important; opacity: 0.8; }

        .zoom-controls { position: absolute; bottom: 10px; right: 10px; display: flex; flex-direction: column; gap: 5px; }
        .zoom-btn { width: 35px; height: 35px; background: rgba(0,0,0,0.6); color: white; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 20px; display:flex; justify-content:center; align-items:center; }

        .bottom-section { width: 95%; max-width: 600px; padding-bottom: 20px; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0; }
        
        .controls { display: flex; gap: 10px; background: #252526; padding: 10px; border-radius: var(--border-radius); align-items: center; }
        .status-text { flex-grow: 1; font-weight: bold; color: #aaa; text-align: left; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .status-text span { color: var(--accent-blue); }
        
        input { padding: 10px; width: 70px; text-align: center; font-size: 16px; border-radius: 4px; border: 1px solid #555; background: #333; color: white; }
        button.guess-btn { padding: 10px 20px; font-size: 14px; font-weight: bold; background: var(--correct-green); color: white; border: none; border-radius: 4px; cursor: pointer; text-transform: uppercase; }
        button.guess-btn:disabled { background: #555; cursor: not-allowed; }

        .history-log { display: flex; flex-direction: column; gap: 5px; max-height: 100px; overflow-y: auto; }
        .history-row { display: flex; justify-content: space-between; background: #252526; padding: 8px 12px; border-radius: 4px; border-left: 5px solid var(--wrong-red); animation: slideIn 0.3s ease-out; font-size: 0.9rem; }
        .history-row.win { border-left-color: var(--correct-green); }
        .history-row.close { border-left-color: var(--partial-yellow); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        #main-timer-box { display: none; text-align: center; background: #252526; padding: 8px; border-radius: 8px; border: 1px solid #444; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: all; }
        .modal-content {
            background: #121213; padding: 30px; border-radius: 10px; text-align: center;
            border: 1px solid #444; width: 90%; max-width: 350px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); position: relative;
        }
        .modal-title { font-size: 1.5rem; margin-bottom: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; color: white; }
        .modal-info { font-size: 1rem; color: #ccc; margin-bottom: 20px; line-height: 1.6; }
        
        .close-btn { position: absolute; top: 10px; right: 15px; background: transparent; border: none; color: #666; font-size: 24px; cursor: pointer; font-weight: bold; }
        .close-btn:hover { color: white; }

        .stats-container { background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px; margin: 15px 0; text-align: left; max-height: 150px; overflow-y: auto; }
        .stat-header { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; text-align: center; color: #aaa; }
        .mini-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #333; font-size: 0.8rem; color: #ccc; }
        .mini-row:last-child { border-bottom: none; }

    </style>
</head>
<body>

    <header>ELECTLE</header>

    <div class="top-section">
        <div class="diagram-container">
            <!-- ‚¨áÔ∏è –í–û–¢ –û–ù–û! referrerpolicy="no-referrer" –°–ü–ê–°–ê–ï–¢ –°–ò–¢–£–ê–¶–ò–Æ ‚¨áÔ∏è -->
            <img id="diagram-img" src="" alt="Parliament Diagram" referrerpolicy="no-referrer">
        </div>
    </div>

    <div class="map-wrapper">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="panZoom.zoomIn()">+</button>
            <button class="zoom-btn" onclick="panZoom.zoomOut()">-</button>
            <button class="zoom-btn" onclick="panZoom.reset()">‚Ü∫</button>
        </div>

        <svg id="world-map" viewBox="0 0 2000 857" xmlns="http://www.w3.org/2000/svg">
            <!-- ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–Æ –ö–ê–†–¢–£ SVG (–í–ï–°–¨ –ö–û–î –ú–ï–ñ–î–£ <svg> –∏ </svg>) ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è -->
            
            <path id="DE" name="Germany" d="M1053.9 158.9l1.4 3.1-1.2 1.7 1.9 2.1 1.5 3.3-0.2 2.2 2.4 3.9-2.2 0.6-1.3-0.7-1.1 1.2-3.5 1.2-1.7 1.6-3.4 1.3 1 1.8 0.7 2.7 2.6 1.5 3 2.6-1.6 2.9-1.7 0.8 1 4.1-0.4 1.1-1.7-1.3-2.4-0.2-3.5 1.1-4.4-0.3-0.6 1.7-2.7-1.7-1.4 0.3-5.5-1.9-1 1.3-4.2 0 0.4-4.5 2.4-4.2-7.2-1.2-2.4-1.6 0.2-2.7-1-1.4 0.4-4.2-1.1-6.5 2.9 0 1.2-2.3 0.9-5.6-0.9-2.1 0.8-1.3 4-0.3 1 1.3 3.1-3-1.3-2.3-0.4-3.4 3.7 0.8 2.9-0.9 0.3 2.3 4.9 1.4 0.1 2.2 4.7-1.2 2.6-1.6 5.6 2.4 2.4 1.9z"></path>
            <path id="FR" name="France" d="M 1035.7 231.4 1034.2 236.3 1031.8 235 1030.5 230.8 1031.4 228.4 1034.6 226 1035.7 231.4 Z M 1014.4 185 1015.5 185.5 1016.9 185.4 1019.3 187 1026.5 188.2 1024.1 192.4 1023.7 196.9 1022.4 198 1020.1 197.4 1020.3 199 1016.7 202.5 1016.7 205.4 1019.1 204.4 1020.9 207.1 1020.8 208.9 1022.3 211.3 1020.6 213.2 1022.1 218.1 1024.9 218.9 1024.4 221.6 1019.9 225.2 1009.7 223.5 1002.3 225.6 1001.7 229.4 995.8 230.2 990 227.3 988.1 228.7 978.6 225.8 976.6 223.4 979.3 219.6 980.3 207 975.2 200.4 971.5 197.2 963.9 194.8 963.5 190.2 970 188.9 978.3 190.5 976.8 183.4 981.5 186.1 992.9 181.3 994.4 176.2 998.6 174.9 999.4 177.1 1001.6 177.2 1004 179.7 1007.5 182.6 1010 182.1 1014.4 185 Z"></path>
            
            <!-- ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è –í–°–¢–ê–í–õ–Ø–ô –°–Æ–î–ê ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è -->
        </svg>
    </div>

    <div class="bottom-section">
        <div class="controls">
            <div class="status-text" id="selected-display">Selected: <span>‚Äî</span></div>
            <input type="number" id="year-input" placeholder="Year" value="">
            <button class="guess-btn" id="submit-btn" onclick="makeGuess()">GUESS</button>
        </div>
        <div class="history-log" id="history"></div>
        
        <!-- –¢–ê–ô–ú–ï–† –ù–ê –ì–õ–ê–í–ù–û–ú –≠–ö–†–ê–ù–ï -->
        <div id="main-timer-box">
            <span style="color: #888; font-size: 0.8em;">NEXT PARLIAMENT IN:</span><br>
            <span class="countdown-text" style="font-size: 1.1em; font-weight: bold; font-family: monospace;">00:00:00</span>
        </div>
    </div>

    <!-- –û–ö–ù–û –ü–û–ë–ï–î–´ -->
    <div id="win-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">‚úï</button>

            <div class="modal-title">üéâ VICTORY!</div>
            <div class="modal-info">
                You identified <b style="color:var(--accent-blue)" id="win-country-name"></b><br>
                Election Year: <b style="color:var(--correct-green)" id="win-year-val"></b>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-container">
                <div class="stat-header">Attempts: <span id="attempt-count">0</span></div>
                <div id="win-history-list"></div>
            </div>

            <div style="font-size: 0.8em; text-transform: uppercase; color: #888; margin-top: 15px;">Next Game In</div>
            <div class="countdown-text" style="font-size: 1.5rem; font-weight: bold; font-family: monospace; margin-top: 5px;">00:00:00</div>
        </div>
    </div>

    <!-- DEV TOOLS (–ö–ù–û–ü–ö–ò –¢–ï–°–¢–ê) -->
    <div style="margin-top: 20px; margin-bottom: 20px; opacity: 0.3; text-align: center; font-size: 10px;">
        <button onclick="devResetDaily()" style="cursor: pointer;">üîÑ Dev: Reset</button>
        <button onclick="devPlayRandom()" style="cursor: pointer;">üé≤ Dev: Random</button>
    </div>

    <script>
        // --- 1. –ë–ê–ó–ê –î–ê–ù–ù–´–• ---
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—ã–µ, –≤–µ—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ Special:FilePath
        // –ö–∞—Ä—Ç–∏–Ω–∫–∏ –±—É–¥—É—Ç SVG (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ) –∏–ª–∏ PNG, –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å ?width=800
        const database = [
            {
                "id": "de",
                "country": "Germany",
                "year": 2021,
                "region": "Europe",
                "img": "https://commons.wikimedia.org/wiki/Special:FilePath/Bundestag_2021.svg",
                "wiki_link": "https://en.wikipedia.org/wiki/2021_German_federal_election"
            },
            {
                "id": "fr",
                "country": "France",
                "year": 2022,
                "region": "Europe",
                "img": "https://commons.wikimedia.org/wiki/Special:FilePath/National_Assembly_2022.svg",
                "wiki_link": "https://en.wikipedia.org/wiki/2022_French_legislative_election"
            }
        ];

        const regionMap = {
            "Europe": ["DE", "FR", "IT", "ES", "GB", "PL", "UA", "RU", "SE", "NO", "FI", "PT", "NL", "BE", "AT", "DK", "GR", "CZ", "HU"],
            "South America": ["BR", "AR", "PE", "CO", "VE", "CL", "EC", "BO", "PY", "UY"],
            "North America": ["US", "CA", "MX"],
            "Asia": ["CN", "JP", "IN", "KR", "ID", "TH", "VN", "TR", "IR", "PK"],
            "Africa": ["EG", "ZA", "NG", "KE", "ET", "MA", "DZ"],
            "Oceania": ["AU", "NZ"]
        };

        // --- 2. –õ–û–ì–ò–ö–ê ---
        function getDailyTarget() {
            const epoch = new Date("2024-01-01");
            const today = new Date();
            const diffTime = Math.abs(today - epoch);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
            const index = diffDays % database.length;
            return database[index];
        }

        let target = getDailyTarget();
        let selectedId = null;
        let selectedName = null;
        let panZoom = null;
        let gameActive = true;

        function getRegionByCountryId(id) {
            const upperId = id.toUpperCase(); 
            for (const [region, countries] of Object.entries(regionMap)) {
                if (countries.includes(upperId)) return region;
            }
            return null;
        }

        window.onload = function() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã —Å–µ–≥–æ–¥–Ω—è
            const todayStr = new Date().toISOString().split('T')[0];
            const lastWon = localStorage.getItem('electle_last_won');

            if (lastWon === todayStr) {
                gameActive = false;
                showWinModal(true);
                document.getElementById('main-timer-box').style.display = 'block'; 
            }

            // –ö–∞—Ä—Ç–∞
            panZoom = svgPanZoom('#world-map', {
                zoomEnabled: true, controlIconsEnabled: false, fit: true, center: true, minZoom: 1, maxZoom: 20
            });

            // –ö–∞—Ä—Ç–∏–Ω–∫–∞
            document.getElementById('diagram-img').src = target.img;

            // –ö–ª–∏–∫–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º
            const paths = document.querySelectorAll('path');
            paths.forEach(p => {
                p.addEventListener('click', () => {
                    if (!gameActive) return;
                    if (p.classList.contains('correct') || p.classList.contains('wrong')) return;
                    
                    if (selectedId) {
                        const old = document.getElementById(selectedId);
                        if(old && !old.classList.contains('regional') && !old.classList.contains('correct')) {
                            old.classList.remove('selected');
                        }
                    }
                    
                    p.classList.add('selected');
                    selectedId = p.id;
                    selectedName = p.getAttribute('name') || p.id;
                    document.getElementById('selected-display').innerHTML = `Selected: <span>${selectedName}</span>`;
                });
            });

            setInterval(updateCountdown, 1000);
            updateCountdown();
        };

        function makeGuess() {
            if (!gameActive) return;

            const yearInput = document.getElementById('year-input');
            const statusText = document.getElementById('selected-display');
            const userYear = parseInt(yearInput.value);

            if (!selectedId) { statusText.innerHTML = "<span style='color:#ff5555'>‚ö† Select a country!</span>"; return; }
            if (!userYear) { statusText.innerHTML = "<span style='color:#ff5555'>‚ö† Enter year!</span>"; return; }

            const mapEl = document.getElementById(selectedId);
            const userRegion = getRegionByCountryId(selectedId);
            
            const isCountryCorrect = (selectedId.toLowerCase() === target.id.toLowerCase());
            const isRegionCorrect = (userRegion === target.region);
            const yearDiff = Math.abs(userYear - target.year);

            // –ö—Ä–∞—Å–∏–º –∫–∞—Ä—Ç—É
            mapEl.classList.remove('selected');

            if (isCountryCorrect) {
                mapEl.classList.add('correct');
            } else if (isRegionCorrect) {
                const regionCountries = regionMap[target.region];
                if (regionCountries) {
                    regionCountries.forEach(countryId => {
                        let el = document.getElementById(countryId) || document.getElementById(countryId.toLowerCase());
                        if (el && el.id !== selectedId && !el.classList.contains('correct')) {
                            el.classList.add('regional');
                        }
                    });
                }
                mapEl.classList.add('wrong');
            } else {
                mapEl.classList.add('wrong');
            }

            // –ò—Å—Ç–æ—Ä–∏—è
            let yearIcon = yearDiff === 0 ? "‚úÖ" : (userYear < target.year ? "‚Üë" : "‚Üì");
            let rowClass = "history-row";
            if (isCountryCorrect && yearDiff === 0) rowClass += " win";
            else if (isCountryCorrect || isRegionCorrect) rowClass += " close";

            let icon = isCountryCorrect ? "üåç‚úÖ" : (isRegionCorrect ? "üåçüü°" : "üåç‚ùå");

            const historyLog = document.getElementById('history');
            const row = document.createElement('div');
            row.className = rowClass;
            row.innerHTML = `<div>${selectedName}</div><div>${icon} | ${userYear} ${yearIcon}</div>`;
            historyLog.prepend(row);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
            if (isCountryCorrect && yearDiff === 0) {
                gameActive = false;
                statusText.innerHTML = "<span style='color:#538d4e'>VICTORY!</span>";
                localStorage.setItem('electle_last_won', new Date().toISOString().split('T')[0]);
                document.getElementById('main-timer-box').style.display = 'block'; 
                setTimeout(() => showWinModal(false), 1500);
            } else if (isCountryCorrect) {
                statusText.innerHTML = `<span style='color:#538d4e'>Correct Country! Fix the Year (${userYear} ${yearIcon})</span>`;
                yearInput.select();
            } else {
                selectedId = null;
                statusText.innerHTML = "Selected: <span>‚Äî</span>";
                yearInput.value = "";
            }
        }

        function showWinModal(instant) {
            document.getElementById('win-country-name').innerText = target.country;
            document.getElementById('win-year-val').innerText = target.year;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('year-input').disabled = true;

            const historyRows = document.querySelectorAll('.history-row');
            document.getElementById('attempt-count').innerText = historyRows.length;
            const listContainer = document.getElementById('win-history-list');
            listContainer.innerHTML = '';
            
            for (let i = 0; i < historyRows.length; i++) {
                const miniRow = document.createElement('div');
                miniRow.className = 'mini-row';
                miniRow.innerHTML = historyRows[i].innerHTML;
                listContainer.appendChild(miniRow);
            }
            
            const modal = document.getElementById('win-modal');
            modal.classList.add('visible');
            if(instant) modal.style.transition = 'none';
        }

        function closeModal() {
            document.getElementById('win-modal').classList.remove('visible');
        }

        function updateCountdown() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            const diff = tomorrow - now;
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            const timeStr = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            document.querySelectorAll('.countdown-text').forEach(t => t.innerText = timeStr);
        }

        function devResetDaily() {
            localStorage.removeItem('electle_last_won');
            location.reload();
        }
        function devPlayRandom() {
            const randomIndex = Math.floor(Math.random() * database.length);
            target = database[randomIndex];
            resetGameState();
            console.log("TEST MODE:", target);
            document.getElementById('selected-display').innerHTML = "<span style='color:orange'>‚ö† TEST: " + target.country + "</span>";
        }
        function resetGameState() {
            gameActive = true; selectedId = null;
            document.querySelectorAll('path').forEach(p => p.classList.remove('correct', 'wrong', 'regional', 'selected'));
            document.getElementById('diagram-img').src = target.img;
            document.getElementById('year-input').value = ''; document.getElementById('year-input').disabled = false;
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('history').innerHTML = '';
            document.getElementById('win-modal').classList.remove('visible');
            document.getElementById('main-timer-box').style.display = 'none';
            if(panZoom) panZoom.reset();
        }
    </script>
</body>
</html>
